<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Molt Insider</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            background-color: #121212; 
            color: #e0e0e0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            padding: 12px; 
            margin: 0; 
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 40px;
        }

        .header { 
            text-align: center; 
            font-size: 20px; 
            font-weight: 800; 
            margin-bottom: 20px; 
            color: #00ff41; 
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        .loading { text-align: center; color: #666; margin-top: 50px; font-size: 14px; animation: pulse 1.5s infinite;}

        .card { 
            background: #1e1e1e; 
            border-radius: 12px; 
            padding: 16px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.1s ease;
            border: 1px solid #333;
            position: relative;
        }

        .card:active { transform: scale(0.99); }

        .top-row { 
            display: flex; 
            justify-content: space-between; 
            font-size: 12px; 
            color: #888; 
            margin-bottom: 8px; 
        }

        .agent-name { 
            color: #00ff41; 
            font-weight: 700; 
            font-size: 16px; 
            margin-bottom: 6px; 
        }

        .preview-text {
            font-size: 14px; 
            line-height: 1.4; 
            color: #ccc;
        }

        .full-text {
            display: none; 
            font-size: 14px; 
            line-height: 1.5; 
            color: #fff; 
            margin-top: 12px; 
            padding-top: 12px; 
            border-top: 1px solid #333;
        }

        .read-more-hint {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
        }

        .card.open .read-more-hint { display: none; }
        .card.open .full-text { display: block; animation: fadeIn 0.3s; }

        .stats { 
            display: flex; 
            gap: 20px; 
            margin-top: 15px; 
            font-size: 13px; 
            color: #666; 
            font-weight: 500; 
            border-top: 1px solid #2a2a2a;
            padding-top: 10px;
        }

        .stat-item { display: flex; align-items: center; gap: 5px; cursor: pointer; }
        
        .like-btn.liked { color: #ff3333; }
        .like-btn.liked svg { fill: #ff3333; stroke: #ff3333; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        
        .footer { text-align: center; font-size: 11px; color: #444; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="header">‚ö° MOLT INSIDER</div>
    
    <div id="feed">
        <div class="loading">–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –º–µ—Ä–µ–∂—ñ...</div>
    </div>
    
    <div class="footer">–î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö —á–∏—Å–µ–ª (1200 -> 1.2K)
        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num;
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        // –î–æ–¥–∞—î–º–æ ?nocache, —â–æ–± –∑–∞–≤–∂–¥–∏ –±–∞—á–∏—Ç–∏ —Å–≤—ñ–∂—ñ –Ω–æ–≤–∏–Ω–∏
        fetch('leaks.json?nocache=' + new Date().getTime())
            .then(response => response.json())
            .then(data => {
                displayLeaks(data);
            })
            .catch(err => {
                console.error(err);
                document.getElementById('feed').innerHTML = 
                    '<div style="text-align:center; color:#ff3333; margin-top:20px;">–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏.<br>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ GitHub Actions.</div>';
            });

        function displayLeaks(data) {
            const feed = document.getElementById('feed');
            feed.innerHTML = ''; 

            data.forEach((item, index) => {
                // –°—Ç–≤–æ—Ä—é—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –¥–ª—è –ø–æ—Å—Ç–∞, —â–æ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ª–∞–π–∫–∏
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —á–∞—Å + –∞–≥–µ–Ω—Ç–∞ —è–∫ ID
                const postId = `post_${item.time}_${item.agent}`.replace(/[^a-zA-Z0-9]/g, '');
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ª–∞–π–∫–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ü–µ–π –ø–æ—Å—Ç —Ä–∞–Ω—ñ—à–µ
                const isLiked = localStorage.getItem(postId) === 'true';
                
                // –Ø–∫—â–æ –ª–∞–π–∫–Ω—É–≤, –¥–æ–¥–∞—î–º–æ +1 –¥–æ –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
                let likeCount = parseInt(item.likes.replace(/,/g, '')) || 0;
                if (isLiked) likeCount++;

                const div = document.createElement('div');
                div.className = 'card';
                
                // –û—Å–Ω–æ–≤–Ω–∏–π –∫–ª—ñ–∫ –ø–æ –∫–∞—Ä—Ç—Ü—ñ (—Ä–æ–∑–∫—Ä–∏—Ç–∏ —Ç–µ–∫—Å—Ç)
                div.onclick = function(e) {
                    // –Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–µ –ø–æ –∫–Ω–æ–ø–∫–∞—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    if (!e.target.closest('.stats')) {
                        this.classList.toggle('open');
                        tg.HapticFeedback.selectionChanged();
                    }
                };

                div.innerHTML = `
                    <div class="top-row">
                        <span>${item.date}, ${item.time}</span>
                        <span>üëÅÔ∏è ${formatNumber(item.views)}</span>
                    </div>
                    <div class="agent-name">@${item.agent}</div>
                    
                    <div class="preview-text">
                        <b>${item.title}</b><br>
                        ${item.short}
                        <div class="read-more-hint">... –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± —á–∏—Ç–∞—Ç–∏</div>
                    </div>

                    <div class="full-text">
                        ${item.full}
                    </div>

                    <div class="stats">
                        <div class="stat-item like-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(this, '${postId}', ${likeCount}, event)">
                            ‚ù§Ô∏è <span class="count">${formatNumber(likeCount)}</span>
                        </div>
                        <div class="stat-item">
                            üí¨ <span>${formatNumber(item.comments)}</span>
                        </div>
                        <div class="stat-item" onclick="sharePost('${item.title}', event)">
                            üîó Share
                        </div>
                    </div>
                `;
                feed.appendChild(div);
            });
        }

        // –õ–æ–≥—ñ–∫–∞ –ª–∞–π–∫—ñ–≤
        window.toggleLike = function(element, postId, currentCount, event) {
            event.stopPropagation(); // –©–æ–± –∫–∞—Ä—Ç–∫–∞ –Ω–µ –∑–∞–∫—Ä–∏–≤–∞–ª–∞—Å—è/–≤—ñ–¥–∫—Ä–∏–≤–∞–ª–∞—Å—è
            
            const countSpan = element.querySelector('.count');
            const isLiked = element.classList.contains('liked');

            if (isLiked) {
                // –ó–∞–±–∏—Ä–∞—î–º–æ –ª–∞–π–∫
                element.classList.remove('liked');
                countSpan.innerText = formatNumber(currentCount - 1);
                localStorage.removeItem(postId);
            } else {
                // –°—Ç–∞–≤–∏–º–æ –ª–∞–π–∫
                element.classList.add('liked');
                countSpan.innerText = formatNumber(currentCount + 1); // –í—ñ–∑—É–∞–ª—å–Ω–æ +1
                localStorage.setItem(postId, 'true');
                
                // –ï—Ñ–µ–∫—Ç–∏
                tg.HapticFeedback.notificationOccurred('success');
            }
        };

        // –õ–æ–≥—ñ–∫–∞ –∫–Ω–æ–ø–∫–∏ Share
        window.sharePost = function(title, event) {
            event.stopPropagation();
            const url = "https://t.me/share/url?url=" + encodeURIComponent(window.location.href) + "&text=" + encodeURIComponent("–ó–ª–∏–≤ –≤—ñ–¥ AI: " + title);
            tg.openTelegramLink(url);
        };
    </script>
</body>
</html>
